<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f4f4f4;
      }
      .container {
        text-align: center;
        background-color: white;
        padding: 30px;
        width: 80%;
        max-width: 900px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .panel-container {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
      }
      .panel {
        width: 48%;
      }
      .submit-btn {
        background-color: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
      }
      .product-list {
        background-color: #fafafa;
        padding: 15px;
        border-radius: 4px;
        margin-top: 20px;
        text-align: left;
      }
      .product-list div {
        margin: 10px 0;
        padding: 10px;
        background-color: #e0e0e0;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div class="container" id="adminPanel" style="display: none;">
      <h1>Headstart</h1>
      <h2>Admin Panel</h2>

      <div class="panel-container">
        <div class="panel">
          <h3>Generate User Account</h3>
          <input type="text" class="input-box" id="newUserEmail" placeholder="Enter user email" />
          <input type="password" class="input-box" id="newUserPassword" placeholder="Enter password" />
          <button class="submit-btn" onclick="generateUserAccount()">Create Account</button>
        </div>

        <div class="panel">
          <h3>Assigned Products to Teams</h3>
          <div id="productList" class="product-list"></div>
        </div>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
      import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";
      import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDvTQ0DeAsFtk-VjMe0FVPV4KYO03Uk3lI",
        authDomain: "headstart-product-development.firebaseapp.com",
        projectId: "headstart-product-development",
        storageBucket: "headstart-product-development.appspot.com",
        messagingSenderId: "718325388324",
        appId: "1:718325388324:web:43009963835dfe0c0374b1"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      // Check logged-in user
      onAuthStateChanged(auth, (user) => {
        const adminPanel = document.getElementById("adminPanel");

        if (user) {
          const email = user.email;
          if (email === "admin@admin.com") {
            adminPanel.style.display = "block";
            fetchProducts(); // Fetch products when admin is logged in
          } else {
            adminPanel.style.display = "none";
          }
        } else {
          window.location.href = "login.html"; // Redirect if not logged in
        }
      });

      // Fetch products and display assigned teams
      async function fetchProducts() {
        const querySnapshot = await getDocs(collection(db, "Products"));
        const productListContainer = document.getElementById("productList");

        querySnapshot.forEach((doc) => {
          const productData = doc.data();
          const productName = doc.id; // Use document ID as product name
          const teamEmails = productData.Team;



          // Create product entry in the list
          let productHTML = `<h4>${productName}</h4>`;

          teamEmails.forEach((teamEmail) => {
            console.log(teamEmail);
            const teamName = teamEmail.split('@')[0]; // Extract team name from email (before '@')
            
            productHTML += `<div>Team: ${teamName} - Product Assigned: ${productName}</div>`;
          });

          productListContainer.innerHTML += productHTML;
        });
      }

      // Generate user account
      window.generateUserAccount = function () {
        const email = document.getElementById("newUserEmail").value;
        const password = document.getElementById("newUserPassword").value;

        if (email === "" || password === "") {
          alert("Please fill in both fields.");
          return;
        }

        createUserWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            // Successfully created new user
            alert("Account successfully created for: " + email);
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            alert("Error: " + errorMessage);
          });
      };
    </script>
  </body>
</html>
